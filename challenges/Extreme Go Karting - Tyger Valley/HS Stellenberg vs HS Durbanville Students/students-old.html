<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Rankings</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        nav { background: #333; padding: 10px; }
        nav a { color: white; margin-right: 15px; text-decoration: none; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #f4f4f4; }
    </style>
</head>
<body>
    <nav>
        <a href="index.html">Home</a>
        <a href="challenge.html">High School Stellenberg vs High School Durbanville</a>
        <a href="students.html">Student Rankings</a>
        <a href="parents.html">Parent Rankings</a>
    </nav>

    <h1>Student Rankings</h1>
    <p>View the rankings for students participating in the challenge.</p>
    <label for="filterSchool">School:</label>
    <select id="filterSchool" onchange="filterTable()">
        <option value="">All</option>
        <option value="Durbanville">Durbanville</option>
        <option value="Stellenberg">Stellenberg</option>
    </select>
    <label for="filterSex">Sex:</label>
    <select id="filterSex" onchange="filterTable()">
        <option value="">All</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
    </select>
    <label for="filterAgeGroup">Age Group:</label>
    <select id="filterAgeGroup" onchange="filterTable()">
        <option value="">All</option>
        <option value="Under 16">Under 16</option>
        <option value="16+">16+</option>
    </select>
    
    <table id="rankingsTable">
        <thead>
            <tr>
                <th>Rank</th>
                <th>Name</th>
                <th>Sex</th>
                <th>Age Group</th>
                <th>School</th>
                <th>Fastest Lap</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    
    <script>
        function loadData() {
            const files = ['durbanville.csv', 'stellenberg.csv'];
            let allData = [];
            let filesProcessed = 0;
            
            files.forEach(file => {
                fetch(file)
                    .then(response => response.text())
                    .then(csv => {
                        Papa.parse(csv, {
                            header: true,
                            dynamicTyping: true,
                            complete: function(results) {
                                allData = allData.concat(results.data);
                                filesProcessed++;
                                if (filesProcessed === files.length) {
                                    displayData(allData);
                                }
                            }
                        });
                    });
            });
        }

        function displayData(data) {
            const tbody = document.querySelector('#rankingsTable tbody');
            tbody.innerHTML = '';
            data.sort((a, b) => a['Fastest Lap'] - b['Fastest Lap']);
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${index + 1}</td><td>${row.Name}</td><td>${row.Sex}</td><td>${row['Age Group']}</td><td>${row.School}</td><td>${row['Fastest Lap']}</td>`;
                tbody.appendChild(tr);
            });
        }

        function filterTable() {
            const schoolFilter = document.getElementById('filterSchool').value;
            const sexFilter = document.getElementById('filterSex').value;
            const ageFilter = document.getElementById('filterAgeGroup').value;
            
            fetch('durbanville.csv')
                .then(response => response.text())
                .then(csv1 => fetch('stellenberg.csv')
                    .then(response => response.text())
                    .then(csv2 => {
                        let allData = [];
                        Papa.parse(csv1, { header: true, dynamicTyping: true, complete: res => allData = allData.concat(res.data) });
                        Papa.parse(csv2, { header: true, dynamicTyping: true, complete: res => {
                            allData = allData.concat(res.data);
                            let filteredData = allData.filter(row => 
                                (schoolFilter === '' || row.School === schoolFilter) &&
                                (sexFilter === '' || row.Sex === sexFilter) &&
                                (ageFilter === '' || row['Age Group'] === ageFilter)
                            );
                            displayData(filteredData);
                        }});
                    })
                );
        }

        window.onload = loadData;
    </script>
</body>
</html>

